

<h2>存储：Illuminate\Session\Store.php</h2>
<pre>
    public function save()
    {
        $this->addBagDataToSession();

        $this->ageFlashData();

        $this->handler->write($this->getId(), $this->prepareForStorage(serialize($this->attributes)));

        $this->started = false;
    }	
</pre>

<h2>读取：Illuminate\Session\Store.php</h2>
<pre>
    /**
     * Read the session data from the handler.
     *
     * @return array
     */
    protected function readFromHandler()
    {
        $data = $this->handler->read($this->getId());

        if ($data) {
            $data = @unserialize($this->prepareForUnserialize($data));

            if ($data !== false && $data !== null && is_array($data)) {
                return $data;
            }
        }

        return [];
    }	
</pre>

<h2>Session 对应的 Cookie 名称保持一致</h2>
<pre>
$ vim config/session.php
    'cookie' => 'zenid',	
</pre>

<h2>保持两边保存到 redis 中的 KEY 命名一致</h2>
<pre>
$ vim config/cache.php
    'stores' => [
        'redis' => [
            'driver' => 'redis',
            'connection' => 'default',
            'prefix' => 'PHPREDIS_SESSION', # 与 ZenCart 中的保持一致
        ],
    ],
</pre>

<h2>修改 PHP 中 Session 的序列化方法</h2>
<pre>
$ vim /etc/httpd/conf.d/php.conf	
php_value session.save_handler "files"
php_value session.save_path    "/var/lib/php/session"
php_value session.serialize_handle "php_serialize" # 使用新的序列化方法

$ vim /etc/php.ini
[Session]
session.serialize_handler = php_serialize
</pre>

<h2>切换前</h2>
<h3>ZenCart</h3>
<p>PHPREDIS_SESSION:02103fd8mo5jb7qia51lnu7lh5</p>
<pre>
"securityToken|s:32:\"5dd256fd9ed34e83c4fae7ba9f274ae1\";customers_host_address|s:0:\"\";customers_ip_country|s:2:\"ZZ\";ship_to|s:2:\"ZZ\";cartID|s:0:\"\";cart|O:12:\"shoppingCart\":8:{s:8:\"contents\";a:0:{}s:5:\"total\";i:0;s:6:\"weight\";i:0;s:12:\"content_type\";b:0;s:18:\"free_shipping_item\";i:0;s:20:\"free_shipping_weight\";i:0;s:19:\"free_shipping_price\";i:0;s:9:\"observers\";a:0:{}}navigation|O:17:\"navigationHistory\":3:{s:4:\"path\";a:0:{}s:8:\"snapshot\";a:0:{}s:9:\"observers\";a:0:{}}language|s:7:\"english\";languages_id|s:1:\"1\";languages_code|s:2:\"en\";currency|s:3:\"USD\";today_is|s:10:\"2016-03-14\";updateExpirations|b:1;recent_products|a:0:{}customers_ip_address|s:11:\"172.16.64.1\";affiliate_referer|s:24:\"http://www.tinydeal.com/\";affiliate_url|s:42:\"/index.php?main_page=ajax_recently_orders&\";"	
</pre>

<p>切换后</p>
<pre>
"a:1:{s:13:\"securityToken\";s:32:\"7a9fbac6815f024941608a722e56937d\";}"	
</pre>

<h3>Laravel</h3>
<p>LARAVEL_SESSION:6d8d36a7abe4318891c60308f47bb8ed489bfb5a</p>
<pre>
"s:293:\"a:5:{s:6:\"_token\";s:40:\"FQQPY5mknlfuPUP6vLQryHLw8BU0XXRnj0DlhQ8v\";s:8:\"language\";s:2:\"en\";s:9:\"_previous\";a:1:{s:3:\"url\";s:32:\"http://laravel.tinydeal.com/blog\";}s:9:\"_sf2_meta\";a:3:{s:1:\"u\";i:1457944508;s:1:\"c\";i:1457944508;s:1:\"l\";s:1:\"0\";}s:5:\"flash\";a:2:{s:3:\"old\";a:0:{}s:3:\"new\";a:0:{}}}\";"	
</pre>


<h2>参考文献</h2>
<ul>
	<li><a href="http://www.freebuf.com/articles/web/90837.html">PHP序列化与反序列化解读</a></li>
	<li>http://ju.outofmemory.cn/entry/99681</li>
	<li>http://www.thinksaas.cn/manual/php/ref.session.html</li>
	<li>http://php.net/manual/zh/ref.session.php</li>
	<li>http://php.net/manual/zh/session.setup.php</li>
	<li>http://drops.wooyun.org/tips/3909</li>
	<li>https://segmentfault.com/q/1010000003776645?_ea=365137</li>
</ul>